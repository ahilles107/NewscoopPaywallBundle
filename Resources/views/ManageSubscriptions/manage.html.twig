{% extends 'NewscoopNewscoopBundle::admin_layout.html.twig' %}

{% block admin_title %}Paywall{% endblock %}
{% block admin_page_title_content %}Manage subscriptions{% endblock %}

{% block admin_stylesheets %}
<link rel="stylesheet" type="text/css" href="{{ asset('admin-style/table.css') }}" />
<link rel="stylesheet" type="text/css" href="{{ asset('admin-style/ColVis.css') }}" />
{% endblock %}
{% block admin_scripts %}
<script src="{{ asset('public/bundles/newscooppaywall/js/jquery.jeditable.js') }}"></script>
<script type="text/javascript">
$(document).ready(function(){
    $('#subscriptionsTable').css('font-size', '13px');
    $('#subscriptionsTable').dataTable( {
        "bJQueryUI": true,
        "sPaginationType": "full_numbers",
    } );

    $('#subscriptionsTable').on('click', '.delete-subscription', function(event){
        var dataTableCell = $(this).parent();
        var dataTableRow = dataTableCell.parent().get(0);
        event.preventDefault();
        $.post($(this).attr('href'), 
           function(data) {
            if (data.status) {
                flashMessage('Subscription has been deleted.');
                dataTableRow.remove();
                return false;
            }
        });
    });

    var oTable = $('#subscriptionsTable').dataTable();
    $('td[class!="readonly"]', oTable.fnGetNodes()).editable( '{{ path('newscoop_paywall_managesubscriptions_edit') }}', {
        "callback": function( sValue ) {
            var aPos = oTable.fnGetPosition( this );
            oTable.fnUpdate( sValue, aPos[0], aPos[1] );
            flashMessage('Subscription has been updated.');
        },
        "submitdata": function ( value, settings ) {
            return {
                "row_id": this.parentNode.getAttribute('id'),
                "column": oTable.fnGetPosition( this )[2]
            };
        },
        "height": "14px"
    } );
});
</script>
{% endblock %}
{% block admin_content %}
<div id="subscription" class="ui-tabs ui-widget ui-widget-content ui-corner-all">
    <ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">
        <li class="ui-state-default ui-corner-top"><a href="{{ path('newscoop_paywall_admin_admin') }}">Add new subscription</a></li>
        <li class="ui-state-default ui-corner-top ui-tabs-selected ui-state-active"><a href="{{ path('newscoop_paywall_managesubscriptions_manage') }}">Manage Subscriptions</a></li>
        <li class="ui-state-default ui-corner-top"><a href="#manageuser">Manage User Subscriptions</a></li>
        <li class="ui-state-default ui-corner-top"><a href="#settings">{{ getGS('Configure Paywall') }}</a></li>
    </ul>
    <table cellpadding="0" cellspacing="0" border="0" class="display" id="subscriptionsTable">
        <thead>
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Duration in days</th>
            <th>Value</th>
            <th>Currency</th>
            <th>Options</th>
        </tr>
    </thead>
    <tbody>
        {% for subscription in subscriptions %}
        <tr id="{{ subscription.id }}">
            <td>{{ subscription.name }}</td>
            <td class="readonly">{{ subscription.type }}</td>
            <td>{{ subscription.range }}</td>
            <td>{{ subscription.price}}</td>
            <td>{{ subscription.currency }}</td>
            <td class="readonly"><a class="delete-subscription" href="{{ path('newscoop_paywall_managesubscriptions_delete', {'id': subscription.id}) }}">Delete</a></td>
        </tr>
        {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Duration in days</th>
        <th>Value</th>
        <th>Currency</th>
        <th>Options</th>
    </tr>
</tfoot>
</table>
</div>
{% endblock %}